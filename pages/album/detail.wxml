<!--ÂèÇËÄÉÊñáÊ°£Ôºöhttps://mp.weixin.qq.com/debug/wxadoc/dev/api/getBackgroundAudioManager.html-->
<import src="../../template/albumItem.wxml" />
<import src="../../template/footer.wxml" />
<import src="../../zanui-weapp/dist/toast/index.wxml" />
<import src="../../zanui-weapp/dist/tab/index.wxml" />
<view class="page flex" style="padding-top:1rpx; width:100%;overflow:hidden;">
     <view class="page__bd">

          <!--‰∏ìËæë‰ø°ÊÅØ-start-->
          <view class="page__bd_spacing" style="width:100%; background-color:#FFFFFF;">
               <view style="float:left; background-color:#FFFFFF;">
                    <image style="width: 280rpx; height: 280rpx; border-radius:6rpx; margin-top:20rpx" mode="aspectFill" src="{{data.albumInfo.cover}}"></image>
                    <!--<text>{{data.albumInfo.listennum}}</text>-->
               </view>
               <view class="main" style="background-color:#fff; height:100%;">
                    <text class="weui-media-box__title" style="display:block;text-overflow: ellipsis;font-size: 32rpx; color:#494949">{{data.albumInfo.title}}</text>
                    <text class="weui-media-box__desc" style="margin-top:10rpx; font-size: 26rpx; color:#9B9B9B">{{data.albumInfo.age_str}}</text>
                    <view>
                         <block wx:for="{{[1, 2, 3, 4, 5]}}" wx:key="data.albumInfo.star_level" wx:for-index="idx" wx:for-item="i">
                              <block wx:if="{{data.albumInfo.star_level > 0}}">
                                   <block wx:if="{{idx + 1 <= data.albumInfo.star_level}}">
                                        <image src="/icon/ic_album_star_selected.png" class="album-star"></image>
                                   </block>
                                   <block wx:else>
                                        <image src="/icon/ic_album_star_normal.png" class="album-star"></image>
                                   </block>
                              </block>
                              <block wx:else>
                                   <image src="/icon/ic_album_star_normal.png" class="album-star"></image>
                              </block>

                         </block>
                    </view>
                    <image bindtap="handleAudioPlayTap" src="{{audioPlayBtnImageUrl}}" style="width: 130rpx; height: 130rpx;position:relative;left:250rpx;" data-album_id="{{data.albumInfo.id}}" data-story_id="{{albumPlayStoryId}}" data-story_idx="{{albumPlayStoryIdx}}">
                    </image>
               </view>
          </view>
          <!--‰∏ìËæë‰ø°ÊÅØ-end-->

          <!--Êî∂Ëóè...ÂàÜ‰∫´‰∏ãËΩΩÂäüËÉΩÂå∫-start-->
          <view class="weui-flex" style="width:100%; background-color:#FFFFFF; border-bottom:1rpx solid #eee;padding-bottom:20rpx; padding-top:20rpx;">
               <view class="weui-flex__item">
                    <block wx:if="{{data.albumInfo.fav == 1}}">
                         <image class="weui-grid__icon album-action-icon" src="/icon/btn_player_fav_pressed.png" style='width:38rpx;height:38rpx;'></image>
                    </block>
                    <block wx:else>
                         <image class="weui-grid__icon album-action-icon" src="/icon/btn_player_fav_normal.png" style='width:38rpx;height:38rpx;'></image>
                    </block>
                    <text class="weui-grid__label album-action-label" wx:if="{{data.albumInfo.favnum > 0}}">{{data.albumInfo.favnum}}</text>
                    <text class="weui-grid__label album-action-label" wx:else>Êî∂Ëóè</text>
               </view>

               <view class="weui-flex__item" bindtap='bindTapComment'>
                    <image class="weui-grid__icon album-action-icon" src="/icon/btn_player_comment_normal.png" style='width:38rpx;height:38rpx;'></image>
                    <text class="weui-grid__label album-action-label" wx:if="{{data.albumInfo.commentnum > 0}}">{{data.albumInfo.commentnum}}</text>
                    <text class="weui-grid__label album-action-label" wx:else>ËØÑËÆ∫</text>
               </view>

               <view class="weui-flex__item" bindtap="toggleBottomPopup">
                    <image class="weui-grid__icon album-action-icon" src="/icon/btn_album_share.png" style='width:38rpx;height:38rpx;'></image>
                    <text class="weui-grid__label album-action-label">ÂàÜ‰∫´</text>
               </view>
          </view>
          <!--Êî∂Ëóè...ÂàÜ‰∫´‰∏ãËΩΩÂäüËÉΩÂå∫-end-->

          <!--ÁÆÄ‰ªã Â£∞Èü≥ Áõ∏‰ºº -start-->
          <view class="weui-tab">
               <!-- <view class="weui-navbar album-detail-navbar" style='height:80rpx;'>
        <view class="weui-navbar__item {{currentTab==0 ? 'weui-bar__item_on' : ''}}" data-current="0" bindtap="handleSwichNav" style='font-size:30rpx;height:40rpx;padding-top:20rpx;padding-bottom:50rpx;'> ÁÆÄ‰ªã</view>
        <view class="weui-navbar__item {{currentTab==1 ? 'weui-bar__item_on' : ''}}" data-current="1" bindtap="handleSwichNav" style='font-size:30rpx;height:40rpx;padding-top:20rpx;padding-bottom:50rpx;'>Â£∞Èü≥</view>
        <view class="weui-navbar__item {{currentTab==2 ? 'weui-bar__item_on' : ''}}" data-current="2" bindtap="handleSwichNav" style='font-size:30rpx;height:40rpx;padding-top:20rpx;padding-bottom:50rpx;'>Áõ∏‰ºº</view>

      </view> -->

               <template is="zan-tab" data="{{tab: tab, componentId: 'tab'}}"></template>
               <view class="weui-tab__panel" style="background-color:#FFFFFF;">

                    <!--‰∏ìËæëÁÆÄ‰ªã-start-->
                    <view class="album-detail-hd" wx:if="{{tab.selectedId == '0'}}">
                         <text class="{{albumIntroBdClass}}" style='color:#494949;font-size:30rpx;line-height:48rpx;'>{{data.albumInfo.intro}}</text>
                         <view class="album-intro-action-btn" bindtap="handleAlbumIntroActionBtn">{{albumIntroBdText}}</view>
                         <view class="weui-grids album-tag-grids">
                              <block wx:for="{{data.tagList}}" wx:key="data.tagList" wx:for-index="index" wx:for-item="tagItem">
                                   <view class="weui-grid album-tag-grid" data-index="{{index}}" data-tag_id="{{tagItem.id}}" bindtap="handleTagTap">
                                        <image class="weui-grid__icon album-tag-icon circular-squareP" mode="aspectFit" src="{{tagItem.cover}}"></image>
                                        <text class="weui-grid__label" style="font-size:26rpx;color:#494949">{{tagItem.name}}</text>
                                   </view>
                              </block>
                         </view>
                    </view>
                    <!--‰∏ìËæëÁÆÄ‰ªã-end-->

                    <!--ÊïÖ‰∫ãÂàóË°® -start-->
                    <view class="weui-cells album-storys-container" wx:if="{{tab.selectedId == '1'}}">
                         <block wx:for="{{data.storyList.items}}" wx:key="data.storyList" wx:for-index="idx" wx:for-item="storyItem">
                              <view style="align: center;" bindtap='handleAudioPlayTap' data-album_id="{{data.albumInfo.id}}" data-story_id="{{storyItem.id}}" data-story_idx="{{idx}}">

                                   <view class="album-story-index" style='color:#9B9B9B;font-size:30rpx; width:auto'>
                                        <view wx:if="{{constant.currentPlayStoryId == storyItem.id && constant.playerStatus == 'play'}}">
                                             <image src="/icon/ic_horn_on.png" style='width:27rpx;height:23rpx;'></image>
                                        </view>
                                        <view wx:if="{{constant.currentPlayStoryId == storyItem.id && constant.playerStatus == 'pause'}}">
                                             <image src="/icon/ic_horn_off.png" style='width:27rpx;height:23rpx;'></image>
                                        </view>
                                        <view wx:if="{{constant.currentPlayStoryId != storyItem.id}}">{{idx + 1}}</view>
                                   </view>
                                   <view class="weui-cell album-story-title" style='color:#494949;font-size:30rpx;'>{{storyItem.title}}</view>
                              </view>
                         </block>

                         <!-- <view class="album-story-action-btn">Êü•ÁúãÊõ¥Â§ö</view> -->
                         <!--Âä†ËΩΩÊõ¥Â§ö-start-->
                         <!-- <view class="weui-loadmore album-story-action-btn">
            <view class="weui-loading"></view>
            <view class="weui-loadmore__tips">Ê≠£Âú®Âä†ËΩΩ</view>
          </view> -->
                         <!--Âä†ËΩΩÊõ¥Â§ö-end-->
                    </view>
                    <!--ÊïÖ‰∫ãÂàóË°®-end-->

                    <!--Áõ∏ÂÖ≥‰∏ìËæë-start-->
                    <view class="album-detail-hd page__bd_spacing" wx:if="{{tab.selectedId == '2'}}">
                         <view class="weui-flex row-container " style="background-color:#FFFFFF;">
                              <block wx:for="{{data.recommendAlbumList}}" wx:key="data.recommendAlbumList" wx:for-index="idx" wx:for-item="albumItem">
                                   <template is="albumItem" data="{{index:idx, id: albumItem.id, title: albumItem.title,cover: albumItem.cover,desc:albumItem.recommenddesc,listenNum:albumItem.listennum,isDescVisible:false,isTagNameVisible:false}}" />
                              </block>
                         </view>
                    </view>
                    <!--Áõ∏ÂÖ≥‰∏ìËæë-end-->

               </view>
               <!--ÁÆÄ‰ªã Â£∞Èü≥ Áõ∏‰ºº -end-->

               <!--ÂàÜ‰∫´popup ÂºÄÂßã-->
               <view class="popup-example--bottom zan-popup zan-popup--bottom {{ isShowBottomPopup ? 'zan-popup--show' : ''}}">
                    <view class="zan-popup__mask" catchtap="toggleBottomPopup"></view>
                    <view class="zan-popup__container">
                         <view class="zan-btns">
                         <!-- style="margin-bottom:0;border-bottom:1rpx solid #eee;" -->
                              <button open-type="share" class="zan-btn"  catchtap="toggleBottomPopup">
                                   ÂèëÈÄÅÁªôÊúãÂèã üç≠ 
                              </button>
                                <!-- <button class="zan-btn" catchtap="generateShareCard">
                                   ÁîüÊàêÂç°ÁâáÂàÜ‰∫´Ëá≥ÊúãÂèãÂúà
                              </button>   -->
                              <button class="zan-btn" catchtap="toggleBottomPopup">
                                   ÂèñÊ∂à
                              </button>
                         </view>
                    </view>
               </view>
               <!--ÂàÜ‰∫´popup ÁªìÊùü-->
          </view>
     </view>

     <!-- Áõ¥Êé•‰ΩøÁî® zan-toast Ê®°ÊùøÔºåÂπ∂‰∏îÁõ¥Êé•‰º†ÂÖ• zanToast -->
     <template is="zan-toast" data="{{ zanToast }}"></template>

     <canvas canvas-id="myCanvas" hidden='true' />

     <!--È°µÂ∞æ-start-->
     <block wx:if="{{isLoaded}}">
          <template is="footer" />
     </block>
     <!--È°µÂ∞æ-end-->
</view>